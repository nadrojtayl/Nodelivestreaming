<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>


<script src="/socket.io/socket.io.js"></script>
<script> var socket = io();</script>



<script>
	function insertClient(outerdivid){

		$("#" + outerdivid).append($("<canvas id = 'streamedto'></canvas>"));
		var ctx = document.getElementById('streamedto').getContext('2d')
   		socket.on('broadcast',function(data){drawto(data.data,ctx)})

		function drawto(url,ctx) {
			//console.log(url);
		    var img = new Image();

		    img.setAttribute('crossOrigin', 'anonymous');
		    img.onload = function(){
		  		ctx.drawImage(img,0,0); // Or at whatever offset you like
			};
			img.src = url;

		}

	}
	function insertStreamer(outerdivid){
		//absolutely position video on screen
		$("#" + outerdivid).append($("<video id = 'streamingvideo'></canvas>"));
		$("#" + outerdivid).append($("<video id = 'fakecanvas'></canvas>"));

		$('#video').css({position: 'absolute'});
		//use browsers getusermedia to get user media
		navigator.getUserMedia = (navigator.getUserMedia ||cnavigator.webkitGetUserMedia ||navigator.mozGetUserMedia ||navigator.msGetUserMedia);

			   if (navigator.getUserMedia) {
			   	console.log('here');
			      navigator.getUserMedia(
			         {
			            video:true,
			            audio:false
			         },
			         function(stream) {
			          var v= document.getElementById('streamingvideo');
			          var url = window.URL || window.webkitURL;
	                  v.src = url ? url.createObjectURL(stream) : stream;
	                  v.play();

			          },
			         function(error) { /* do something */ }
			      );
			   }
			   // else {
			   //    alert('Sorry, the browser you are using doesn\'t support getUserMedia');
			   //    return;
			   //  }
			var draw = function() {
				var video = document.querySelector('video');
				var canvas = document.getElementById('fakecanvas')
				//console.log('CANVAS',canvas)
				canvas.width = 750;
				canvas.height = 460;
				canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
				//var ctx = document.getElementById('canvas2').getContext('2d')
		   		var dataurl = canvas.toDataURL()
		   		//dataurl = JSON.stringify(dataurl).slice(Math.floor(dataurl.length/3))
		   		// $.ajax({
		   		// 	method:'POST',
		   		// 	url:'http://localhost:3000/posted',
		   		// 	data: {url:dataurl}
		   		// })
		   		socket.emit('picdata',{data:dataurl})
		  // 		drawto(dataurl,ctx)
	   		}

	   		setInterval(draw,300);
	   		//var ctx = document.getElementById('canvas3').getContext('2d')
	   //		socket.on('broadcast',function(data){drawto(data.data,ctx)})

		//	function drawto(url,ctx) {
		//	    var img = new Image();
	//
	//		    img.setAttribute('crossOrigin', 'anonymous');
	//		    img.onload = function(){
	//		  		ctx.drawImage(img,0,0); // Or at whatever offset you like
	//			};
	//			img.src = url;

	//		}
	}
</script>